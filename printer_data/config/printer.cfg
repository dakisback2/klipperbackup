[include mainsail.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

## *** THINGS TO CHANGE/CHECK: ***
## MCU paths                            [mcu] section
## Thermistor types                     [extruder] and [heater_bed] sections - See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types
## Z Endstop Switch location            [safe_z_home] section
## Homing end position                  [gcode_macro G32] section
## Z Endstop Switch  offset for Z0      [stepper_z] section
## Probe points                         [quad_gantry_level] section
## Min & Max gantry corner postions     [quad_gantry_level] section
## PID tune                             [extruder] and [heater_bed] sections
## Probe pin                            [probe] section
## Fine tune E steps                    [extruder] section
[include mainsail.cfg]
[include stealthburner_leds.cfg]

[force_move]
enable_force_move: True

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
##--------------------------------------------------------------------
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_310041000F51323532393433-if00
restart_method: command
##--------------------------------------------------------------------

[mcu H36]

serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_41002A000950415742363820-if00
restart_method: command

[mcu cartographer]
#canbus_uuid: 0ca8d67388c2 
serial: /dev/serial/by-id/usb-Cartographer_614e_3C001C001943303854303720-if00
is_non_critical: True
#    adjust to suit your scanner, if using usb change to serial

[cartographer]
mcu: cartographer            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 27.5
verbose: yes

[temperature_sensor cartographer]
sensor_type: temperature_mcu
sensor_mcu: cartographer
min_temp: 5
max_temp: 105

[temperature_sensor H36]
sensor_type: temperature_mcu
sensor_mcu: H36
min_temp: 0
max_temp: 150

[temperature_sensor H36_Extruder_2209]
sensor_type: Generic 3950
sensor_pin: H36: PA3
min_temp:0
max_temp:150

[delayed_gcode RESTORE_PROBE_OFFSET]
initial_duration: 1.
gcode:
  {% set svv = printer.save_variables.variables %}
  {% if not printer["gcode_macro SET_GCODE_OFFSET"].restored %}
    SET_GCODE_VARIABLE MACRO=SET_GCODE_OFFSET VARIABLE=runtime_offset VALUE={ svv.nvm_offset|default(0) }
    SET_GCODE_VARIABLE MACRO=SET_GCODE_OFFSET VARIABLE=restored VALUE=True
  {% endif %}



[adxl345]

# cs_pin: cartographer:PA3
# spi_bus: spi1
# axes_map: x, -y, -z #carto
cs_pin: H36:PB12
spi_software_sclk_pin: H36:PB10
spi_software_mosi_pin: H36:PB11
spi_software_miso_pin: H36:PB2
axes_map: y, -z, -x


[resonance_tester]
accel_chip: adxl345
probe_points: 175, 175, 20 # Fill out the blank with x and y coordinates where you want to run the resonance test.
sweeping_period: 0
accel_per_hz: 100

[motors_sync]
axes: x,y
# #    Axes on which calibration will be performed.
accel_chip:adxl345
# #    Accelerometer for vibrations collection: adxl345 / mpu9250 etc.

[input_shaper]
shaper_freq_x: 112.4 # center frequency for the X axis filter
shaper_type_x: ei # filter type for the X axis
smoother_freq_y: 61.2 # center frequency for the Y axis filter
shaper_type_y: smooth_zv # filter type for the Y axis
damping_ratio_x: 0.0061
# #shaper_freq_y: 46.0
# damping_ratio_x: .045 # damping ratio for the X axis
# damping_ratio_y: .036 # damping ratio for the Y axis

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
measurements_chunk_size: 10
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

[printer]
kinematics: corexy
max_velocity: 700 
max_accel: 15000           #Max 4000
max_z_velocity: 25          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 8.0

[axis_twist_compensation]
calibrate_start_x: 50
calibrate_end_x: 300
calibrate_y: 175
calibrate_start_y: 25
calibrate_end_y: 275
calibrate_x: 175

# [auto_speed]
# #axis: diag_x, diag_y  ; One or multiple of `x`, `y`, `diag_x`, `diag_y`, `z`

# margin: 40           ; How far away from your axes to perform movements

# #settling_home: 1      ; Perform settling home before starting Auto Speed
# max_missed: 63       ; Maximum full steps that can be missed
# endstop_samples: 2    ; How many endstop samples to take for endstop variance

# accel_min: 3000.0     ; Minimum acceleration test may try
# #accel_max: 50000.0    ; Maximum acceleration test may try
# #accel_accu: 0.05      ; Keep binary searching until the result is within this percentage

# velocity_min: 500.0    ; Minimum velocity test may try
# #velocity_max: 5000.0  ; Maximum velocity test may try
# #velocity_accu: 0.05   ; Keep binary searching until the result is within this percentage

# #derate: 0.8           ; Derate discovered results by this amount

# #validate_margin: Unset      ; Margin for VALIDATE, Defaults to margin
# #validate_inner_margin: 20.0 ; Margin for VALIDATE inner pattern
# #validate_iterations: 50     ; Perform VALIDATE pattern this many times

# #results_dir: ~/printer_data/config ; Destination directory for graphs

[exclude_object]


[autotune_tmc stepper_x]
motor:ldo-42sth48-2804ah
sgt: 0
voltage: 48
tuning_goal: silent
[autotune_tmc stepper_x1]
motor:ldo-42sth48-2804ah
sgt: 0
voltage: 48
tuning_goal: silent
[autotune_tmc stepper_y]
motor:ldo-42sth48-2804ah
sgt: 0
voltage: 48
tuning_goal: silent
[autotune_tmc stepper_y1]
motor:ldo-42sth48-2804ah
sgt: 0
voltage: 48
tuning_goal: silent
[autotune_tmc stepper_z]
motor: moons-ms17hd6p420I-04
voltage: 48
[autotune_tmc stepper_z1]
motor: moons-ms17hd6p420I-04
voltage: 48
[autotune_tmc stepper_z2]
motor: moons-ms17hd6p420I-04
voltage: 48
[autotune_tmc stepper_z3]
motor: moons-ms17hd6p420I-04
voltage: 48

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
high_precision_step_compress: True
dir_pin: PE1
step_pin: PE2
enable_pin: !PE0
rotation_distance: 40
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc5160_stepper_x:virtual_endstop #PG9
position_min: 0
##--------------------------------------------------------------------

##  Uncomment below for 250mm build
#position_endstop: 250
#position_max: 250

##  Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##  Uncomment for 350mm build
position_endstop: 350
position_max: 350

##--------------------------------------------------------------------
homing_speed: 160   #Max 100
homing_retract_dist: 75

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_x]
cs_pin: PD4
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
diag1_pin: ^!PF1
interpolate: True
run_current: 2.4
home_current: .21
sense_resistor: 0.05

[stepper_x1]
high_precision_step_compress: True
dir_pin: PC13
step_pin: PC14
enable_pin: !PE6
rotation_distance: 40
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper

[tmc5160 stepper_x1]
cs_pin: PD6
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
diag1_pin: ^!PC15
interpolate: True
run_current: 2.4
sense_resistor: 0.05

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
high_precision_step_compress: True
dir_pin: PB8
step_pin: PB9
enable_pin: !PB7
rotation_distance: 40
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc5160_stepper_y:virtual_endstop #PG6
position_min: 0
##--------------------------------------------------------------------

##  Uncomment for 250mm build
#position_endstop: 250
#position_max: 250

##  Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##  Uncomment for 350mm build
position_endstop: 354
position_max: 354

##--------------------------------------------------------------------
homing_speed: 100  #Max 100
homing_retract_dist: 75

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_y]
interpolate: True
cs_pin: PD3
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
diag1_pin: ^!PF2
sense_resistor: 0.05
run_current: 2.4
home_current: .15

[stepper_y1]
high_precision_step_compress: True
dir_pin: PE4
step_pin: PE5
enable_pin: !PE3
rotation_distance: 40
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper

[tmc5160 stepper_y1]
cs_pin: PD5
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
diag1_pin: ^!PF0
interpolate: True
run_current: 2.4
sense_resistor: 0.05

#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
high_precision_step_compress: True
step_pin: PG15
dir_pin: !PB6
enable_pin: !PG14
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0
##  Z-position of nozzle (in mm) to z-endstop trigger point relative to print surface (Z0)
##  (+) value = endstop above Z0, (-) value = endstop below
##  Increasing position_endstop brings nozzle closer to the bed
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
#position_endstop: -0.5
##--------------------------------------------------------------------

##  Uncomment below for 250mm build
#position_max: 210

##  Uncomment below for 300mm build
#position_max: 260

##  Uncomment below for 350mm build
position_max: 310

##--------------------------------------------------------------------
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_z]
interpolate: True
cs_pin: PA10
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
sense_resistor: 0.075
run_current: 1

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
high_precision_step_compress: True
step_pin: PG9
dir_pin: PG10
enable_pin: !PG13
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_z1]
interpolate: True
cs_pin: PD2
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
sense_resistor: 0.074
run_current: 1
##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
high_precision_step_compress: True
step_pin: PG11
dir_pin: !PD7
enable_pin: !PG12
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_z2]
interpolate: True
cs_pin: PA15
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
sense_resistor: 0.075
run_current: 1

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
high_precision_step_compress: True
step_pin: PB4
dir_pin: PB3
enable_pin: !PB5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc5160 stepper_z3]
interpolate: True
cs_pin: PA9
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
sense_resistor: 0.075
run_current: 1


#####################################################################
#   Extruder
#####################################################################
[verify_heater extruder]
max_error: 150
hysteresis: 10
##  Connected to MOTOR_6
##  Heater - HE0
##  Thermistor - T0
[extruder]
step_pin: H36:PB9
dir_pin: !H36:PB8
enable_pin: !H36:PB7
##  Update value below when you perform extruder calibration
##  If you ask for 100mm of filament, but in reality it is 98mm:
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
##  22.6789511 is a good starting point
rotation_distance: 22.333097095725   #Bondtech 5mm Drive Gears
##  Update Gear Ratio depending on your Extruder Type
##  Use 50:10 for Stealthburner/Clockwork 2
##  Use 50:17 for Afterburner/Clockwork (BMG Gear Ratio)
##  Use 80:20 for M4, M3.1
gear_ratio: 50:10               #BMG Gear Ratio
microsteps: 32
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: H36:PA7
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for NTC 100k 3950 thermistors
sensor_type: PT1000
sensor_pin: H36:PA6
pullup_resistor: 2200
min_temp: 10
max_temp: 375
max_power: 1.0
min_extrude_temp: 170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
##  Try to keep pressure_advance below 1.0
pressure_advance: 0.045
##  Default is 0.040, leave stock
#pressure_advance_smooth_time: 0.040
# control: mpc
# heater_power: 47 
# cooling_fan: fan
# filament_density: 1.29
# filament_heat_capacity: 2.2 

##  E0 on MOTOR6
##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 extruder]
uart_pin: H36:PC14
diag_pin: H36:PC15
interpolate: True
run_current: 0.5
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
##  Uncomment the following line if using the default SSR wiring from the docs site
heater_pin: PF7
##  Other wiring guides may use BED_OUT to control the SSR. Uncomment the following line for those cases
#heater_pin: PA1
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for Keenovo heaters
sensor_type: Generic 3950
sensor_pin: PB1
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.8
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  Inductive Probe
##  This probe is not used for Z height, only Quad Gantry Leveling
##[probe]

#--------------------------------------------------------------------

## Select the probe port by type:
## For the PROBE port. Will not work with Diode. May need pull-up resistor from signal to 24V.
#pin: ~!PB7
## For the DIAG_7 port. NEEDS BAT85 DIODE! Change to !PG15 if probe is NO.
##pin: H36:!PA8
## For Octopus Pro PROBE port; NPN and PNP proximity switch types can be set by jumper
#pin: ~!PC5

#--------------------------------------------------------------------

##x_offset: 0
##y_offset: 25.0
#z_offset: 0
##speed: 10.0
##samples: 3
##samples_result: median
##sample_retract_dist: 3.0
##samples_tolerance: 0.006
##samples_tolerance_retries: 3

#####################################################################
#   Fan Control
#####################################################################


[multi_pin printcool_fan]
pins: H36:PA9,H36:PB15

[multi_pin Bed_fans]
pins: PA0,PA1,PA2

[fan_generic BedFans]
pin: multi_pin:Bed_fans
#cycle_time: .05
kick_start_time: .5

##  Print Cooling Fan - FAN0
[fan]
pin: multi_pin:printcool_fan
kick_start_time: 0.5
##  Depending on your fan, you may need to increase this value
##  if your fan will not start. Can change cycle_time (increase)
##  if your fan is not able to slow down effectively
off_below: 0.10

##  Print Cooling Fan - FAN1
##[fan]
##pin: H36:PB15
##kick_start_time: 0.5
##  Depending on your fan, you may need to increase this value
##  if your fan will not start. Can change cycle_time (increase)
##  if your fan is not able to slow down effectively
##off_below: 0.10

##  Hotend Fan - FAN1
[heater_fan hotend_fan]
pin: H36:PB13
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##  If you are experiencing back flow, you can reduce fan_speed
fan_speed: .6

##  Controller fan - FAN2
[controller_fan controller_fan_1]
pin: PA3
kick_start_time: 5
heater: heater_bed
fan_speed: .4
cycle_time: 0.0000151

[controller_fan controller_fan_2]
pin: PA4
kick_start_time: 5
heater: heater_bed
fan_speed: .4
cycle_time: 0.0000151



#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
#[output_pin caselight]
#pin: PB10
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
home_xy_position:175.00,175.00
speed:200
z_hop:10
z_hop_speed:25


##  Use QUAD_GANTRY_LEVEL to level a gantry.
##  Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
##  MAX (250, 250), (300,300), or (350,350) depending on your printer size
##  to respective belt positions
[quad_gantry_level]

#--------------------------------------------------------------------
##  Gantry Corners for 250mm Build
##  Uncomment for 250mm build
#gantry_corners:
#   -60,-10
#   310, 320
##  Probe points
#points:
#   50,25
#   50,175
#   200,175
#   200,25
    
##  Gantry Corners for 300mm Build
##  Uncomment for 300mm build
#gantry_corners:
#   -60,-10
#   360,370
##  Probe points
#points:
#   50,25
#   50,225
#   250,225
#   250,25

##  Gantry Corners for 350mm Build
##  Uncomment for 350mm build
gantry_corners:
   -60,-10
   410,420
##  Probe points
points:
   50,25
   50,275
   300,275
   300,25

#--------------------------------------------------------------------
speed: 500
horizontal_move_z: 5
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # FPC header, Aliases EXP1 & EXP2 for mini12864
    EXP1_1=PG5, EXP1_2=PG4,
    EXP1_3=PG3, EXP1_4=PG2,
    EXP1_5=PD15, EXP1_6=PD14,
    EXP1_7=PD13, EXP1_8=PD12,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PG8, EXP2_4=PE11,
    EXP2_5=PG7, EXP2_6=PE14,
    EXP2_7=PG6, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>

#####################################################################
#   Displays
#####################################################################

##  Uncomment the display that you have
#--------------------------------------------------------------------


##  RepRapDiscount 128x64 Full Graphic Smart Controller
#[display]
#lcd_type: st7920
#cs_pin: EXP1_4
#sclk_pin: EXP1_5
#sid_pin: EXP1_3
#menu_timeout: 40
#encoder_pins: ^EXP2_5, ^EXP2_3
#click_pin: ^!EXP1_2

#[output_pin beeper]
#pin: EXP1_1

#--------------------------------------------------------------------


##  mini12864 LCD Display
[display]
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

##  To control Neopixel RGB in mini12864 display
[neopixel btt_mini12864]
pin: EXP1_6
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.0
color_order: RGB

##  Set RGB values on boot up for each Neopixel. 
##  Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
        SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
        SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
        SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3 

#--------------------------------------------------------------------
[bed_mesh]
zero_reference_position: 175, 175    
#    set this to the middle of your bed
speed: 300
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 35, 35
#    start point of bed mesh [X, Y]
mesh_max: 300, 320
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic
adaptive_margin: 15


#####################################################################
#   Macros
#####################################################################

[gcode_macro _BEDFANVARS]
variable_threshold: 100		# If bed temp target is above this threshold, fans tun on slow, until target reached, then turn on fast.
variable_slowthreshold: 50	# AKInferno Added: if the bed temp target is above this threshold, fans turn on and stay slow.
variable_fast: 1.0		# Current of fast Fan speed
variable_slow: 0.3		# Current of slow Fan speed (while bed is heating / for targets below top threshold / fan speed during cooldown 
variable_offthreshold: 45  	# AKInferno Added: run fan after bed is turned off, until the bed temp falls below this temp.
gcode:
[gcode_macro BEDFANSSLOW]
gcode:
	# Vars
	{% set SLOW = printer["gcode_macro _BEDFANVARS"].slow|float %}
	SET_FAN_SPEED FAN=BedFans SPEED={SLOW}

[gcode_macro BEDFANSFAST]
gcode:
	# Vars
	{% set FAST = printer["gcode_macro _BEDFANVARS"].fast|float %}
	SET_FAN_SPEED FAN=BedFans SPEED={FAST}

[gcode_macro BEDFANSOFF]
gcode:
	SET_FAN_SPEED FAN=BedFans SPEED=0

############ Command overrides ############

# Override, set fan speeds to low and start monitoring loop.
[gcode_macro SET_HEATER_TEMPERATURE]
rename_existing: _SET_HEATER_TEMPERATURE
gcode:
	# Parameters
	{% set HEATER = params.HEATER|default("None") %}
	{% set TARGET = params.TARGET|default(0)|int %}
	# Vars
	{% set THRESHOLD = printer["gcode_macro _BEDFANVARS"].threshold|int %}
	{% set SLOWTHRESHOLD = printer["gcode_macro _BEDFANVARS"].slowthreshold|int %}
	
	{% if HEATER|lower == "extruder" %}
		M104 S{TARGET}
	{% elif HEATER|lower == "heater_bed" %}
		M99140 S{TARGET}
	{% else %}
		{action_respond_info("Heater %s not supported" % HEATER)}
	{% endif %}

	# Set fans to low if heater_bed temp is requested above threshold temp, and kick off monitoring loop.
	{% if HEATER|lower == "heater_bed" %}
		{% if TARGET >= THRESHOLD %}
			BEDFANSSLOW
			UPDATE_DELAYED_GCODE ID=bedfanloop DURATION=1
		{% elif TARGET >= SLOWTHRESHOLD %}	# added this to Ellis' original config to turn fans on low, but not start the monitoring loop for targets in PLA/PETG range. 
			BEDFANSSLOW
		{% else %}
			TURN_OFF_HEATERS
		{% endif %}
	{% endif %}
	
# Override M190 (Wait for Bed Temperature)
# As a bonus, use TEMPERATURE_WAIT so we don't have to wait for PID to level off.
[gcode_macro M190]
rename_existing: M99190
gcode:
	# Parameters
	{% set S = params.S|int %}
	# Vars
	{% set THRESHOLD = printer["gcode_macro _BEDFANVARS"].threshold|int %}
	
	{% if S >= THRESHOLD %}
		BEDFANSSLOW																# >= Threshold temp: Low speed fans while heating 
	{% else %}
		TURN_OFF_HEATERS														# < Threshold temp: Turn bed fans off
	{% endif %}                                        

	M140 {% for p in params
	  %}{'%s%s' % (p, params[p])}{%
	  endfor %}																	# Set bed temp
	  
	{% if S != 0 %}
		TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={S|int} MAXIMUM={S|int + 5}	# Wait for bed temp within 5 degrees
	{% endif %}

	# Post-heating fan speeds
	{% if S >= THRESHOLD %}								    
		BEDFANSFAST																# >= Threshold temp: Higher speed fans after heating finished
	{% endif %}
	
# Replace M140 (Set Bed Temperature) to just be an alias of SET_HEATER_TEMPERATURE (which has associated bed fan logic if enabled)
[gcode_macro M140]
rename_existing: M99140
gcode:
	# Parameters
	{% set S = params.S|float %}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={S}
	
# Replace TURN_OFF_HEATERS
[gcode_macro TURN_OFF_HEATERS]
rename_existing: _TURN_OFF_HEATERS
gcode:
	_TURN_OFF_HEATERS											# Turn off heaters
 	{% if printer.heater_bed.temperature|int >= printer["gcode_macro _BEDFANVARS"].offthreshold %}		# If bed temp is above Off Theshold, start timer for bedfan for 5min and shutdown heaters
		UPDATE_DELAYED_GCODE ID=bedfanloop DURATION=300	
	{% endif %}

################ Monitoring loop #####################

# Turns bed fans to "fast" speed once target bed temp is reached.
[delayed_gcode bedfanloop]
gcode:
	# Vars
	{% set THRESHOLD = printer["gcode_macro _BEDFANVARS"].threshold|int %}
	{% set COOLDOWN = printer["gcode_macro _BEDFANVARS"].offthreshold %}
	
	{% if printer.heater_bed.target >= THRESHOLD %}								# Continue only if target temp greater than threshold.
		{% if printer.heater_bed.temperature|int >= (printer.heater_bed.target|int - 1) %}
			BEDFANSFAST										# If within 1 degree of target temp: Higher speed fans
		{% else %}
			UPDATE_DELAYED_GCODE ID=bedfanloop DURATION=5						# If temp not reached yet: loop again
		{% endif %}
	{% elif printer.heater_bed.target == 0 %}								# If TARGET is 0 (So fans turned off)
		{% if printer.heater_bed.temperature|int >= COOLDOWN %}							# AND if Bed temperature is above Off Threshold
			BEDFANSSLOW												# Set to slow fanspeed
			UPDATE_DELAYED_GCODE ID=bedfanloop DURATION=300								# start timer to check again in 5 min
		{% else %}
			BEDFANSOFF					# TARGET is 0 and bed temp is < Off Threshold turn Filter off and don't restart timer
		{% endif %}
	{% endif %}

[gcode_macro G32]
gcode:
    SAVE_GCODE_STATE NAME=STATE_G32
    G90
    G28
    QUAD_GANTRY_LEVEL
    G28
    ##  Uncomment for for your size printer:
    #--------------------------------------------------------------------
    ##  Uncomment for 250mm build
    #G0 X125 Y125 Z30 F3600
    
    ##  Uncomment for 300 build
    #G0 X150 Y150 Z30 F3600
    
    ##  Uncomment for 350mm build
    #G0 X175 Y175 Z30 F3600
    #--------------------------------------------------------------------
    RESTORE_GCODE_STATE NAME=STATE_G32

[gcode_macro CLEAN_NOZZLE_PARK]
gcode:
 {% if "xyz" not in printer.toolhead.homed_axes %}
   G28
 {% endif %}

  G90

  ## Ooze position. Set this position right above the bucket.
  G1 X325 Y352 Z1 F6000

[gcode_macro CLEAN_NOZZLE]
variable_start_x: 296   ; Set this X distance so that it's at the right edge of the scrubber.
variable_start_y: 353  ; Set this Y distance so that the nozzle is above the rear row of bristles.
variable_start_z: 0.35   ; Set this Z distance so that the nozzle tip is buried in the scrubber.
variable_wipe_dist: -35
variable_wipe_qty: 5
variable_wipe_spd: 200
variable_raise_distance: 10

gcode:
 {% if "xyz" not in printer.toolhead.homed_axes %}
   G28
 {% endif %}
 
 G90                                            ; absolute positioning
 
 ## Move nozzle to start position
 G1 X{start_x} Y{start_y} F6000
 G1 Z{start_z} F1500

 ## Wipe nozzle
 {% for wipes in range(1, (wipe_qty + 1)) %}
   G1 X{start_x + wipe_dist} Y{start_y} F{wipe_spd * 60}
   G1 X{start_x} Y{start_y} F{wipe_spd * 60}
   G1 X{start_x + wipe_dist} Y{start_y - 5} F{wipe_spd * 60}
   G1 X{start_x} Y{start_y -5} F{wipe_spd * 60}
 {% endfor %}

 ## Raise nozzle
 G1 X{start_x + 8} Z{raise_distance}

#####################################################################
#   A better print_start macro for v2/trident
#####################################################################

## *** THINGS TO UNCOMMENT: ***
## Bed mesh (2 lines at 2 locations)
## Nevermore (if you have one)
## Z_TILT_ADJUST (For Trident only)
## QUAD_GANTRY_LEVEL (For V2.4 only)

[gcode_macro PRINT_START]
gcode:
  # This part fetches data from your slicer. Such as bed, extruder, and chamber temps and size of your printer.
  {% set target_bed = params.BED|int %}
  {% set target_extruder = params.EXTRUDER|int %}
  {% set target_chamber = params.CHAMBER|default("45")|int %}
  {% set x_wait = printer.toolhead.axis_maximum.x|float / 2 %}
  {% set y_wait = printer.toolhead.axis_maximum.y|float / 2 %}

  SET_GCODE_OFFSET Z=0                                 # Set offset to 0

  # Home the printer, set absolute positioning and update the Stealthburner LEDs.
  STATUS_HOMING                                         # Set LEDs to homing-mode
  G28                                                   # Full home (XYZ)
  G90                                                   # Absolute position
  sync_motors

  ##  Uncomment for bed mesh (1 of 2 for bed mesh)
  #BED_MESH_CLEAR                                       # Clear old saved bed mesh (if any)

  # Check if the bed temp is higher than 90c - if so then trigger a heatsoak.
  {% if params.BED|int > 90 %}
    SET_DISPLAY_TEXT MSG="Bed: {target_bed}c"           # Display info on display
    STATUS_HEATING                                      # Set LEDs to heating-mode
    M106 S255                                           # Turn on the PT-fan

    ##  Uncomment if you have a Nevermore.
    #SET_PIN PIN=nevermore VALUE=1                      # Turn on the nevermore

    G1 X{x_wait} Y{y_wait} Z15 F9000                    # Go to center of the bed
    M190 S{target_bed}                                  # Set the target temp for the bed
    SET_DISPLAY_TEXT MSG="Heatsoak: {target_chamber}c"  # Display info on display
    TEMPERATURE_WAIT SENSOR="temperature_sensor cartographer" MINIMUM={target_chamber}   # Waits for chamber temp

  # If the bed temp is not over 90c, then skip the heatsoak and just heat up to set temp with a 5 min soak
  {% else %}
    SET_DISPLAY_TEXT MSG="Bed: {target_bed}c"           # Display info on display
    STATUS_HEATING                                      # Set LEDs to heating-mode
    G1 X{x_wait} Y{y_wait} Z15 F9000                    # Go to center of the bed
    M190 S{target_bed}                                  # Set the target temp for the bed
    SET_DISPLAY_TEXT MSG="Soak for 5 min"               # Display info on display
    G4 P300000                                          # Wait 5 min for the bedtemp to stabilize
  {% endif %}

  # Heat hotend to 150c. This helps with getting a correct Z-home.
  SET_DISPLAY_TEXT MSG="Hotend: 150c"                   # Display info on display
  M109 S150                                             # Heat hotend to 150c

  ##  Uncomment for Trident (Z_TILT_ADJUST)
  #SET_DISPLAY_TEXT MSG="Leveling"                      # Display info on display
  #STATUS_LEVELING                                      # Set LEDs to leveling-mode
  #Z_TILT_ADJUST                                        # Level the printer via Z_TILT_ADJUST
  #G28 Z                                                # Home Z again after Z_TILT_ADJUST

  ##  Uncomment for V2.4 (Quad gantry level AKA QGL)
  SET_DISPLAY_TEXT MSG="Leveling"                      # Display info on display
  STATUS_LEVELING                                      # Set LEDs to leveling-mode
  QUAD_GANTRY_LEVEL                                    # Level the printer via QGL
  G28 Z                                                # Home Z again after QGL

  ##  Uncomment for bed mesh (2 of 2 for bed mesh)
  SET_DISPLAY_TEXT MSG="Bed mesh"                      # Display info on display
  STATUS_MESHING                                       # Set LEDs to bed mesh-mode
  BED_MESH_CALIBRATE                                   # Start the bed mesh (add ADAPTIVE=1) for adaptive bed mesh
  #CLEAN_NOZZLE
  CARTOGRAPHER_TOUCH_HOME                              # Calibrate z offset only with hot nozzle

  # Heat up the hotend up to target via data from slicer
  SET_DISPLAY_TEXT MSG="Hotend: {target_extruder}c"     # Display info on display
  STATUS_HEATING                                        # Set LEDs to heating-mode
  #CLEAN_NOZZLE_PARK                                     # Park Nozzle and prep for heating
  M107                                                  # Turn off partcooling fan
  M109 S{target_extruder}                               # Heat the hotend to set temp

  # Get ready to print by doing a primeline and updating the LEDs
  SET_DISPLAY_TEXT MSG="Printer goes brr"               # Display info on display
  STATUS_PRINTING                                       # Set LEDs to printing-mode                                                 # Incremental positioning 
  #CLEAN_NOZZLE
  G92 E0 ; Reset Extruder
  G1 Z2.0 F3000 ; Move Z Axis up little to prevent scratching of Heat Bed
  G1 X4 Y40 Z0.2 F10000.0 ; Move to start position
  G1 X4 Y220.0 Z0.2 F2000.0 E15 ; Draw the first line
  G1 X5 Y220.0 Z0.2 F6000.0 ; Move to side a little
  G1 X5 Y40 Z0.2 F2000.0 E30 ; Draw the second line
  G92 E0 ; Reset Extruder

#   Use PRINT_END for the slicer ending script - please customise for your slicer of choice
[gcode_macro PRINT_END]
gcode:
    # safe anti-stringing move coords
    {% set th = printer.toolhead %}
    {% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
    {% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
    {% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
    
    SAVE_GCODE_STATE NAME=STATE_PRINT_END
    
    M400                           ; wait for buffer to clear
    G92 E0                         ; zero the extruder
    G1 E-5.0 F1800                 ; retract filament
    
    TURN_OFF_HEATERS
    
    G90                                      ; absolute positioning
    G0 X{x_safe} Y{y_safe} Z{z_safe} F20000  ; move nozzle to remove stringing
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600  ; park nozzle at rear
    M107                                     ; turn off fan
    
    BED_MESH_CLEAR
    RESTORE_GCODE_STATE NAME=STATE_PRINT_END


[gcode_macro TEST_SPEED]
# Home, get position, throw around toolhead, home again.
# If MCU stepper positions (first line in GET_POSITION) are greater than a full step different (your number of microsteps), then skipping occured.
# We only measure to a full step to accomodate for endstop variance.
# Example: TEST_SPEED SPEED=300 ACCEL=5000 ITERATIONS=10

description: Test for max speed and acceleration parameters for the printer. Procedure: Home -> ReadPositionFromMCU -> MovesToolhead@Vel&Accel -> Home -> ReadPositionfromMCU

gcode:
    # Speed
    {% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
    # Iterations
    {% set iterations = params.ITERATIONS|default(5)|int %}
    # Acceleration
    {% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
    # Minimum Cruise Ratio
    {% set min_cruise_ratio = params.MIN_CRUISE_RATIO|default(0.5)|float %}
    # Bounding inset for large pattern (helps prevent slamming the toolhead into the sides after small skips, and helps to account for machines with imperfectly set dimensions)
    {% set bound = params.BOUND|default(20)|int %}
    # Size for small pattern box
    {% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
    
    # Large pattern
        # Max positions, inset by BOUND
        {% set x_min = printer.toolhead.axis_minimum.x %}
        {% if x_min < 0 %}
            {% set x_min = 0 %}
        {% endif %}
    
        {% set y_min = printer.toolhead.axis_minimum.y %}
        {% if y_min < 0 %}
            {% set y_min = 0 %}
        {% endif %}
    
        {% set x_min = x_min + bound %}
        {% set x_max = printer.toolhead.axis_maximum.x - bound %}
        {% set y_min = y_min + bound %}
        {% set y_max = printer.toolhead.axis_maximum.y - bound %}
    
    # Small pattern at center
        # Find X/Y center point
        {% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
        {% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
        
        # Set small pattern box around center point
        {% set x_center_min = x_center - (smallpatternsize/2) %}
        {% set x_center_max = x_center + (smallpatternsize/2) %}
        {% set y_center_min = y_center - (smallpatternsize/2) %}
        {% set y_center_max = y_center + (smallpatternsize/2) %}

    # Save current gcode state (absolute/relative, etc)
    SAVE_GCODE_STATE NAME=TEST_SPEED
    
    # Output parameters to g-code terminal
    { action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
    
    # Home and get position for comparison later:
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28
        # QGL if not already QGLd (only if QGL section exists in config)
        {% if printer.configfile.settings.quad_gantry_level %}
            {% if printer.quad_gantry_level.applied == False %}
                QUAD_GANTRY_LEVEL
                G28 Z
            {% endif %}
        {% endif %} 
        # Move 50mm away from max position and home again (to help with hall effect endstop accuracy - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/24)
        G90
        G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28 X Y
        G0 X{printer.toolhead.axis_maximum.x-1} Y{printer.toolhead.axis_maximum.y-1} F{30*60}
        G4 P1000 
        GET_POSITION

    # Go to starting position
    G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}

    # Set new limits
    {% if printer.configfile.settings.printer.minimum_cruise_ratio is defined %}
        SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} MINIMUM_CRUISE_RATIO={min_cruise_ratio}
    {% else %}
        SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
    {% endif %}

    {% for i in range(iterations) %}
        # Large pattern diagonals
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_max} Y{y_max} F{speed*60}
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
        G0 X{x_min} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
        
        # Large pattern box
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_min} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
    
        # Small pattern diagonals
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_max} Y{y_center_max} F{speed*60}
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
        G0 X{x_center_min} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
        
        # Small pattern box
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_min} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
    {% endfor %}

    # Restore max speed/accel/accel_to_decel to their configured values
    {% if printer.configfile.settings.printer.minimum_cruise_ratio is defined %}
        SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} MINIMUM_CRUISE_RATIO={printer.configfile.settings.printer.minimum_cruise_ratio} 
    {% else %}
        SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
    {% endif %}

    # Re-home and get position again for comparison:
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28 # This is a full G28 to fix an issue with CoreXZ - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/12
        # Go to XY home positions (in case your homing override leaves it elsewhere)
        G90
        G0 X{printer.toolhead.axis_maximum.x-1} Y{printer.toolhead.axis_maximum.y-1} F{30*60}
        G4 P1000 
        GET_POSITION

    # Restore previous gcode state (absolute/relative, etc)
    RESTORE_GCODE_STATE NAME=TEST_SPEED

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 40.269
#*# pid_ki = 1.123
#*# pid_kd = 360.907
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 25.778
#*# pid_ki = 2.644
#*# pid_kd = 62.834
#*#
#*# [stepper_z]
#*# position_endstop = 1.670
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.106977, 0.109449, 0.110243, 0.112710, 0.110970, 0.107662, 0.108566, 0.112717, 0.116906, 0.121135, 0.125155, 0.131146, 0.135305, 0.142779, 0.151956, 0.156114, 0.154081, 0.153877, 0.152108, 0.148646, 0.143493, 0.138336, 0.129929, 0.124652, 0.123595, 0.120903, 0.120821, 0.119114, 0.121411, 0.120461
#*# 	0.092494, 0.093400, 0.095996, 0.096618, 0.094967, 0.093161, 0.097311, 0.101461, 0.104153, 0.106459, 0.110739, 0.116593, 0.122447, 0.130788, 0.140837, 0.146691, 0.147922, 0.146165, 0.142704, 0.137675, 0.128966, 0.123866, 0.118768, 0.115056, 0.112445, 0.112392, 0.110494, 0.107880, 0.106963, 0.107734
#*# 	0.066352, 0.077333, 0.079775, 0.081294, 0.079524, 0.078528, 0.079378, 0.086967, 0.089504, 0.093640, 0.097774, 0.105280, 0.112920, 0.122069, 0.133061, 0.138915, 0.135083, 0.129979, 0.126518, 0.121341, 0.113581, 0.107607, 0.100633, 0.098783, 0.092602, 0.090872, 0.090855, 0.089841, 0.087241, 0.084637
#*# 	0.057672, 0.055936, 0.058293, 0.060780, 0.058013, 0.055361, 0.050811, 0.058445, 0.066181, 0.075376, 0.082965, 0.088955, 0.096406, 0.103985, 0.115030, 0.119157, 0.120274, 0.115224, 0.108300, 0.101373, 0.092837, 0.087637, 0.080698, 0.076986, 0.073538, 0.071830, 0.074326, 0.071745, 0.067493, 0.073346
#*# 	0.031733, 0.028976, 0.033059, 0.032090, 0.034489, 0.031754, 0.025334, 0.031250, 0.042420, 0.051856, 0.055886, 0.059982, 0.065971, 0.075199, 0.085439, 0.095670, 0.096943, 0.091737, 0.086526, 0.077941, 0.069075, 0.060466, 0.053479, 0.048950, 0.047214, 0.044659, 0.042916, 0.040430, 0.040371, 0.040438
#*# 	0.013208, 0.012214, 0.013720, 0.013452, 0.012425, 0.014803, 0.013627, 0.019554, 0.027361, 0.033083, 0.039069, 0.044923, 0.053369, 0.060168, 0.071195, 0.084102, 0.085252, 0.081929, 0.074947, 0.064427, 0.054903, 0.045362, 0.038214, 0.032854, 0.030184, 0.028534, 0.028656, 0.024342, 0.023438, 0.029724
#*# 	-0.000066, -0.004652, 0.001142, 0.001733, 0.002323, 0.008387, 0.008841, 0.013124, 0.018206, 0.025018, 0.034300, 0.040154, 0.046008, 0.048428, 0.061265, 0.070668, 0.075505, 0.071916, 0.065046, 0.054487, 0.043904, 0.035220, 0.024734, 0.020893, 0.018366, 0.010591, 0.009729, 0.009125, 0.010034, 0.009281
#*# 	-0.011941, -0.011225, -0.014091, -0.011737, -0.005925, -0.002670, -0.001078, 0.003072, 0.007200, 0.012222, 0.020701, 0.026555, 0.032538, 0.038256, 0.047754, 0.060686, 0.061861, 0.056753, 0.050615, 0.040900, 0.030396, 0.021543, 0.011002, 0.006325, 0.001168, -0.001348, -0.002187, -0.005534, -0.009017, -0.004423
#*# 	-0.037070, -0.032076, -0.027024, -0.025584, -0.017826, -0.011875, -0.009526, -0.007179, -0.004595, -0.002350, 0.004406, 0.011162, 0.016889, 0.024669, 0.035801, 0.045254, 0.048237, 0.043114, 0.037860, 0.028162, 0.014833, 0.005935, -0.006486, -0.013843, -0.018162, -0.022352, -0.023154, -0.025646, -0.022759, -0.025326
#*# 	-0.037497, -0.035928, -0.036304, -0.032159, -0.029690, -0.025668, -0.021517, -0.017240, -0.012982, -0.010759, -0.004905, 0.002766, 0.012116, 0.016154, 0.028279, 0.039484, 0.041714, 0.038256, 0.033122, 0.021534, 0.009915, -0.004211, -0.014980, -0.022355, -0.024839, -0.027329, -0.029945, -0.035961, -0.035773, -0.033771
#*# 	-0.046024, -0.049927, -0.043045, -0.042410, -0.038392, -0.033331, -0.031001, -0.025941, -0.021684, -0.016740, -0.009976, -0.004121, 0.003555, 0.007580, 0.018896, 0.030067, 0.033214, 0.031435, 0.024483, 0.012856, -0.000500, -0.014817, -0.025499, -0.032038, -0.037214, -0.041533, -0.045851, -0.048324, -0.047121, -0.047893
#*# 	-0.052903, -0.054225, -0.053600, -0.049454, -0.047135, -0.042985, -0.037132, -0.032854, -0.030491, -0.024573, -0.020548, -0.012865, -0.003414, 0.002433, 0.011874, 0.023196, 0.022721, 0.021084, 0.013852, 0.001521, -0.007435, -0.022721, -0.033499, -0.038202, -0.042520, -0.046709, -0.048319, -0.055472, -0.057813, -0.056718
#*# 	-0.067015, -0.068377, -0.062390, -0.061922, -0.056060, -0.050069, -0.045919, -0.039930, -0.037386, -0.033497, -0.029356, -0.021660, -0.014032, -0.008247, 0.001279, 0.010803, 0.011178, 0.006871, -0.000261, -0.012790, -0.019939, -0.031721, -0.043404, -0.048974, -0.054224, -0.059347, -0.060072, -0.064385, -0.064989, -0.063744
#*# 	-0.066890, -0.067275, -0.065950, -0.061679, -0.059370, -0.053441, -0.049228, -0.045203, -0.042661, -0.038654, -0.032800, -0.026946, -0.017404, -0.009776, -0.002082, 0.005548, 0.008745, 0.003454, -0.004478, -0.016235, -0.021546, -0.034144, -0.044975, -0.052351, -0.054934, -0.055524, -0.060711, -0.065025, -0.070212, -0.074530
#*# 	-0.074746, -0.071575, -0.067425, -0.066973, -0.062823, -0.058672, -0.056373, -0.051297, -0.047835, -0.042111, -0.036257, -0.028552, -0.020848, -0.015001, -0.007429, -0.001449, 0.001764, -0.003535, -0.010687, -0.020561, -0.032311, -0.039494, -0.050413, -0.057738, -0.062056, -0.066375, -0.068825, -0.071267, -0.073782, -0.076171
#*# 	-0.068109, -0.069490, -0.069033, -0.066674, -0.064311, -0.062015, -0.056011, -0.051924, -0.045750, -0.040026, -0.036021, -0.030041, -0.020613, -0.010946, -0.003371, 0.000636, 0.002865, 0.000391, -0.010451, -0.021192, -0.031155, -0.039146, -0.050072, -0.053784, -0.059971, -0.062421, -0.064868, -0.065448, -0.073501, -0.074086
#*# 	-0.074035, -0.068166, -0.067710, -0.068992, -0.063978, -0.058964, -0.052965, -0.046963, -0.044492, -0.038573, -0.034571, -0.026995, -0.021010, -0.009748, 0.001637, 0.005648, 0.003332, -0.000189, -0.009127, -0.021852, -0.030760, -0.041615, -0.048748, -0.054329, -0.058648, -0.064717, -0.067285, -0.069730, -0.070312, -0.072762
#*# 	-0.065007, -0.068230, -0.065924, -0.063627, -0.061263, -0.057048, -0.049327, -0.047026, -0.042769, -0.038636, -0.034634, -0.026928, -0.016518, -0.002503, 0.006965, 0.011106, 0.013261, 0.005208, -0.001935, -0.010802, -0.025250, -0.035153, -0.046940, -0.050652, -0.054971, -0.058356, -0.063608, -0.066056, -0.072241, -0.071090
#*# 	-0.065070, -0.066446, -0.060581, -0.059997, -0.055847, -0.051696, -0.047546, -0.044381, -0.039138, -0.036978, -0.031124, -0.025144, -0.010254, 0.004717, 0.008736, 0.012756, 0.011424, 0.008824, 0.001683, -0.005334, -0.018889, -0.028774, -0.041534, -0.048849, -0.053292, -0.058420, -0.063671, -0.066243, -0.070438, -0.069288
#*# 	-0.061584, -0.062888, -0.060518, -0.058214, -0.055910, -0.049913, -0.047609, -0.043459, -0.037355, -0.031501, -0.027493, -0.017952, -0.001194, 0.008317, 0.014171, 0.018196, 0.019550, 0.014264, 0.012631, 0.001838, -0.010699, -0.021552, -0.030564, -0.037862, -0.042181, -0.048360, -0.050818, -0.056991, -0.061311, -0.063769
#*# 	-0.054315, -0.051998, -0.049677, -0.049076, -0.043217, -0.040900, -0.038589, -0.032600, -0.028342, -0.024327, -0.016572, -0.008947, 0.002406, 0.013611, 0.020442, 0.032613, 0.032138, 0.026858, 0.020664, 0.012639, 0.007477, -0.001479, -0.018605, -0.026009, -0.031126, -0.037422, -0.041741, -0.045129, -0.048396, -0.048224
#*# 	-0.043549, -0.041219, -0.036159, -0.035662, -0.030470, -0.028274, -0.024124, -0.020822, -0.015588, -0.011687, -0.004008, 0.003672, 0.014994, 0.027984, 0.035652, 0.046938, 0.046463, 0.041195, 0.034113, 0.028837, 0.023559, 0.014772, -0.001465, -0.010547, -0.013030, -0.019184, -0.023374, -0.027817, -0.032991, -0.032784
#*# 	-0.029325, -0.026986, -0.019214, -0.018690, -0.017257, -0.013886, -0.011680, -0.007530, -0.006778, -0.002744, 0.006750, 0.014290, 0.025584, 0.035054, 0.042717, 0.050374, 0.049772, 0.048248, 0.042013, 0.032285, 0.021566, 0.014596, 0.007497, 0.000133, -0.005882, -0.012158, -0.016413, -0.018961, -0.023280, -0.025774
#*# 	-0.012091, -0.010634, -0.007383, -0.003237, -0.004491, -0.002145, 0.003810, 0.007960, 0.010544, 0.018973, 0.025728, 0.033384, 0.042836, 0.052273, 0.057164, 0.065645, 0.068754, 0.061842, 0.056522, 0.047738, 0.038873, 0.031805, 0.024863, 0.017529, 0.011401, 0.005395, 0.003732, 0.001165, -0.004060, -0.008379
#*# 	0.008428, 0.012710, 0.017617, 0.017313, 0.016244, 0.018608, 0.019249, 0.026014, 0.031166, 0.042243, 0.046446, 0.052236, 0.058154, 0.069217, 0.076850, 0.084482, 0.084007, 0.078772, 0.073663, 0.064855, 0.056033, 0.047332, 0.038492, 0.032982, 0.027763, 0.020873, 0.018226, 0.017510, 0.013191, 0.008873
#*# 	0.023714, 0.027798, 0.031883, 0.032625, 0.033235, 0.031176, 0.037989, 0.045686, 0.053484, 0.059338, 0.063291, 0.069276, 0.078537, 0.086151, 0.095534, 0.103151, 0.118206, 0.113132, 0.095622, 0.083469, 0.074827, 0.066040, 0.059024, 0.052707, 0.047563, 0.046675, 0.045914, 0.043377, 0.034614, 0.031317
#*# 	0.047238, 0.047956, 0.053788, 0.054569, 0.051706, 0.052341, 0.060007, 0.069419, 0.077177, 0.081282, 0.085385, 0.089486, 0.100594, 0.106441, 0.115661, 0.125005, 0.143496, 0.140038, 0.115933, 0.104669, 0.095070, 0.088228, 0.079488, 0.070480, 0.067928, 0.063610, 0.064448, 0.060268, 0.055950, 0.049869
#*# 	0.063835, 0.067985, 0.072135, 0.074548, 0.076228, 0.074295, 0.080185, 0.089547, 0.095406, 0.101260, 0.105513, 0.112969, 0.117221, 0.128135, 0.135723, 0.143306, 0.143627, 0.140966, 0.134184, 0.125659, 0.118591, 0.110850, 0.103105, 0.097783, 0.095075, 0.093370, 0.093334, 0.090824, 0.077938, 0.073486
#*# 	0.088744, 0.089468, 0.095332, 0.096904, 0.096894, 0.097604, 0.101754, 0.108418, 0.117041, 0.122895, 0.128611, 0.134603, 0.142963, 0.149735, 0.157167, 0.163021, 0.165114, 0.161657, 0.157339, 0.147020, 0.136818, 0.131634, 0.124860, 0.119286, 0.116694, 0.114101, 0.114952, 0.108917, 0.108039, 0.101866
#*# 	0.113491, 0.117505, 0.119959, 0.125937, 0.128325, 0.127455, 0.131469, 0.139148, 0.148351, 0.159275, 0.161749, 0.165913, 0.173457, 0.180997, 0.188539, 0.194393, 0.198841, 0.192923, 0.190374, 0.178604, 0.171619, 0.166463, 0.161378, 0.157735, 0.155112, 0.150656, 0.152265, 0.150488, 0.142787, 0.138469
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 300.0
#*# min_y = 35.0
#*# max_y = 320.0
#*#
#*# [cartographer touch_model default]
#*# threshold = 2745
#*# speed = 2
#*# z_offset = -0.05
#*#
#*# [cartographer scan_model default]
#*# coefficients = 1.3686267599025332,1.8224120896149825,0.8175157069687137,0.3503643283493687,0.5034197915125174,0.764228185890677,-0.3352071902878222,-0.7784718257800995,0.4450515046735203,0.5423156399933511
#*# domain = 3.1220556762715026e-07,3.342455687332188e-07
#*# z_offset = 0
#*# reference_temperature = 76.09
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.033856, -0.003206, 0.040027, 0.014465, -0.017429
#*# compensation_start_x = 40.0
#*# compensation_end_x = 310.0
#*# zy_compensations = -0.018266, -0.003867, 0.009005, 0.008615, 0.004513
#*# compensation_start_y = 40.0
#*# compensation_end_y = 282.5
#*#
#*# [input_shaper]
#*#
#*# [cartographer]
#*# z_backlash = 0.00603
#*#
#*# [motors_sync]
#*# steps_model_x = quadratic,
#*# 	22.45412037347668,
#*# 	167.1571607936989,
#*# 	298.8089599153217
#*# steps_model_y = quadratic,
#*# 	22.45412037347668,
#*# 	167.1571607936989,
#*# 	298.8089599153217
